<!-- DevelopingProjects.html -->
<!-- Created by Carol Clark on 12/17/11 for project Support. -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>DevelopingProjects</title>
	<link rel="stylesheet" type="text/css" href="../css/technical.css" />	
</head>
<body>
<div class='navhead' id='Top'><table class='navhead'><col class='navhead_c1' /><tr> <td>[<a href="../Support/Support.html">Support</a>]</td> <td >[<a href="History_Support.html#Contents">History</a>]</td><td class='right'>[<a href="#Contents">Contents</a>]</td></tr></table></div>
<h1>Developing Projects</h1>

<!-- @topicList "DevelopingProjects" "Contents" -->
	<!-- @topicItem "Projects and Targets" "#Target_" "0" "" -->
	<!-- @topicItem "Interface Builder" "#InterfaceBuilder" "0" "" -->
	<!-- @topicItem "Porting C++ to Objective-C" "#PortingCppToObjC" "0" "" -->
<!-- @/topicList -->

<p>tasks and refactorings related to development with Xcode projects</p>

<!-- @marker "Targets and Build Phases" -->
<h2>Targets and Build Phases</h2>

<!-- @topicList "Projects and Targets" "Target_" -->
	<!-- @topicItem "Xcode Project Settings" "#pbxproj" "0" "" -->
	<!-- @topicItem "Add Cocoa Target" "#AddCocoaTarget" "0" "" -->
	<!-- @topicItem "Add Target Feature" "#AddTargetFeature" "0" "" -->
	<!-- @topicItem "Add Run Script Target" "#AddRunScriptTarget" "0" "" -->
	<!-- @topicItem "Promote Build Phase to Target" "#PromoteRunPhaseToTarget" "0" "" -->
	<!-- @topicItem "Add Unit Testing" "#AddUnitTesting" "0" "" -->
	<!-- @topicItem "Add Doxygen Target" "#AddDoxygenTarget" "0" "" -->
<!-- @/topicList -->

<!-- @marker "Xcode Project Settings" -->
<h4 id='pbxproj'>Xcode Project Settings</h4><ul>
	<li><b>Project</b><ul>
		<li>start with an empty project and add targets to it</li>
		<li><b>ProjectName</b> for generic project, use Build&lt;ProjectName&gt;</li>
		<li class='depr'><b>Source folder</b> support Source folder that can be shared among multiple projects<ul>
			<li>USER_HEADER_SEARCH_PATHS = ${SRCROOT}/Source/**</li>
		</ul></li>
		<li class='depr'><b>initial target:</b> override Xcode's default behavior to name initial target with project name<ul>
			<li>rename the target's product and its folder inside &lt;TargetName&gt;Build/&lt;</li>
			<li>INFOPLIST_FILE = &lt;TargetName&gt;/&lt;TargetName&gt;-Info.plist</li>
			<li>GCC_PREFIX_HEADER = &lt;TargetName&gt;/&lt;TargetName&gt;-Prefix.pch</li>
		</ul></li>
	</ul></li>
	<li><b>Schemes</b> mark all schemes "shared"</li>
	<li><b>Targets</b><ul>
		<li><b>Test Targets</b> from Cocoa Unit Test Bundle<ul>
			<li>Logic Tests include files for tested code in the target; Application Tests do not</li>
			<li><b>Application Tests</b>: set up tests to run inside Application<ul>
				<li>BUNDLE_LOADER = $(BUILT_PRODUCTS_DIR)/&lt;ProjectName&gt;.app/Contents/MacOS/&lt;ProjectName&gt;</li>
				<li>TEST_HOST = $(BUNDLE_LOADER)</li>
			</ul></li>
		</ul></li>
		<li><b>Script targets</b> Bundle targets; remove all template build phases except Target Dependencies; delete .pch file; add Run Script build phase<ul>
			<li><b>Cdoc</b> script: buildCdoc &lt;WorkspaceName&gt;</li>
			<li><b>Doxygen</b> script: doxygenBuild &lt;WorkspaceName&gt;</li>
		</ul></li>
		<li><b>InHouse</b> products installed for InHouse use<ul>
			<li><b>Product</b> set installation location for the target to be istalled<ul>
				<li>INSTALL_PATH = /Applications</li>
				<li>DSTROOT = $(HOME)</li>
			</ul></li>
			<li><b>InHouse</b> script target: xcodebuild install -target &lt;TargetName&gt; -configuration Debug DEPLOYMENT_LOCATION=YES SYMROOT=${HOME}/CCDev/build</li>
		</ul></li>
	</ul></li>
</ul>

<!-- @marker "Add Cocoa Target" -->
<h4 id='AddCocoaTarget'>Add Cocoa Target</h4><ul>
	<li>open the Project that will contain the target</li>
	<li>add Target from indicated template; check ARC (only) as indicated</li>
	<li>mark scheme "shared"</li>
	<li class='depr'>add <span class='mono'>\rConfidential and Proprietary.</span> to copyright notice</li>
	<li class='depr'>USER_HEADER_SEARCH_PATHS = ${SRCROOT}/Source/**</li>
	<li>AppDelegate: rename to &lt;Target&gt;AppDelegate; update AppDelegate object in xib</li>
	<li>add a source group for &lt;Target&gt;; add file references to group &lt;Target&gt;</li>
	<li><a href="#AddUnitTesting">Add Unit Testing</a></li>
	<li>if there is not already a Doxygen target for this project, <a href="#AddDoxygenTarget">Add Doxygen Target</a></li>
</ul>

<!-- @marker "Add Target Feature" -->
<h4 id='AddTargetFeature'>Add Target Feature</h4><ul>
	<li><b>Core Data</b><ul>
		<li>add Data Model file</li>
		<li>create new &lt;Target&gt;AppDelegate from private template _ObjectiveC/CocoaClass/NSApplicationDelegate, with option Use Core Data; recover any preexisting code</li>
		<li>for Core Data tests, use private template _ObjectiveC/CocoaTestClass/NSManagedObject; see <a href="http://stackoverflow.com/questions/1849802/how-to-unit-test-my-models-now-that-i-am-using-core-data">Testing Core Data discussion</a></li>
	</ul></li>
</ul>

<!-- @marker "Add Run Script Target" -->
<h4 id='AddRunScriptTarget'>Add Run Script Target</h4><ul>
	<li>create new Aggregate target<ul>
		<li>mark scheme as shared</li>
		<li class='depr'>delete files *.pch, InfoPlist.strings from target's SupportingFiles group</li>
		<li class='depr'>remove build phases Compile Sources, Link Binary with Libraries, Copy Bundle resources</li>
		<li>add Run Script build phase</li>
	</ul></li>
</ul>

<!-- @marker "Promote Run Phase to Target" -->
<h4 id='PromoteRunPhaseToTarget'>Promote Run Phase to Target</h4><ul class='blurb'>
		<li>make a Run Script build phase into its own target</li>
		<li>use to separately control the steps in building a product</li>
	</ul><ul>
		<li><a href="#AddRunScriptTarget">Add Run Script Target</a></li>
		<li>copy script from its build phase in the old target to the new Run Script phase in the new target</li>
		<li>in the original target's scheme, add the new target to the target list of the Build section</li>
		<li>test build</li>
		<li>in the original target, remove the Run Script build phase that has been replaced</li>
	</ul>

<!-- @marker "Add Unit Testing" -->
<h4 id='AddUnitTesting'>Add Unit Testing</h4><ul>
	<li class='blurb'>from iPhoneUnitsSample ReadMe: "Important: Application targets with unit tests cannot be built or run using the iPhone Simulator SDK; they can be built and run only using the iPhone Device SDK." The sample produces two copies of the app, one with Unit Tests and one without.</li>
	<li>Add Logic and App Test Targets<ul>
		<li>for each: add a new target from Cocoa Unit Testing Bundle template; mark scheme "shared"; add to &lt;Target&gt; scheme's Test specification</li>
		<li>for App Tests: also set Build Settings: BUNDLE_LOADER: $(BUILT_PRODUCTS_DIR)/&lt;Target&gt;.app/Contents/MacOS/&lt;Target&gt;; TEST_HOST: $(BUNDLE_LOADER)</li>
		<li>for Logic Tests: also replace &lt;Target&gt;LogicTests with &lt;Target&gt;AppDelegateTest</li>
	</ul></li>
	<li>set up debugging<ul>
		<li>add Exception breakpoint with action Debugger Command <span class='mono'>log message</span></li>
		<li>add Symbolic breakpoint at -[SenTestCase failWithException:]</li>
	</ul></li>
</ul>
	
<!-- @marker "Add Doxygen Target" -->
<h4 id='AddDoxygenTarget'>Add Doxygen Target</h4><ul>
	<li>add Run Script build phase or <a href="#AddRunScriptTarget">target</a>: doxygenBuild &lt;ProjectName&gt;</li>
	<li>add file &lt;Project&gt;.doxygen from template; set parameters as indicated, using Dev/Support/Default.doxygen as a reference</li>
</ul>

<!-- @marker "Interface Builder" -->
<h2>Interface Builder</h2>
<!-- @topicList "Interface Builder" "InterfaceBuilder" -->
	<!-- @topicItem "Remove IB Outlet" "#RemoveIBOutlet" "0" "" -->
	<!-- @topicItem "Rename IB Outlet" "#RenameIBOutlet" "0" "" -->
	<!-- @topicItem "Rename IB Object" "#RenameIBObject" "0" "" -->
<!-- @/topicList -->

<!-- @marker "Remove IB Outlet" -->
<h4 id='RemoveIBOutlet'>Remove IB Outlet</h4><ul>
	<li>ensure that the IBOutlet variable is not accessed in code</li>
	<li>in Interface Builder, delete the outlet connection</li>
	<li>remove all occurrences of the IBOutlet variable in code</li>
</ul>

<!-- @marker "Rename IB Outlet" -->
<h4 id='RenameIBOutlet'>Rename IB Outlet</h4><ul>
	<li>add outlet connection for new name</li>
	<li>compare the properties of the variables with the old and new names; make new variable match original intent</li>
	<li>change all uses of the original variable to use the new name</li>
	<li>apply <a href="#RemoveIBOutlet">Remove IB Outlet</a> to the original variable name</li>
</ul>

<!-- @marker "Rename IB Object" -->
<h4 id='RenameIBObject'>Rename IB Object</h4><ul>
	<li>in Interface Builder's hierarchical list, rename the object</li>
	<li>apply <a href="#RenameIBOutlet">Rename IB Outlet</a> as indicated to rename IBOutlet connections to the renamed object</li>
</ul>

<!-- @marker "Porting C++ to Objective-C" -->
<h2>Porting C++ to Objective-C</h2>

<!-- @topicList "Porting C++ to Objective-C" "PortingCppToObjC" -->
	<!-- @topicItem "Porting Overview" "#PortingOverview" "0" "" -->
		<!-- @topicItem "Porting: Naming Conventions" "#PortingNamingConventions" "1" "" -->
	<!-- @topicGroup "" "3" -->
	<!-- @topicItem "Deimplement Method" "#DeimplementMethod" "0" "" -->
	<!-- @topicItem "Import C++ Class" "#ImportCppClass" "0" "" -->
	<!-- @topicItem "Wrap C++ Class with Objective-C" "#WrapCppClassWithObjC" "0" "" -->
<!-- @/topicList -->

<!-- @marker "Porting Overview" -->
<h4 id='PortingOverview'>Porting Overview</h4><ul>
	<li>Motivation<ul>
		<li>For Mac development, C++ is being replaced by Cocoa with Objective-C.</li>
		<li>Xcode supports and we consistently use a testing framework for Objective-C, but not for C++.</li>
		<li>C++ code is incompatible with Objective-C Automatic Reference Counting.</li>
	</ul></li>
	<li>AccessorC9<ul>
		<li>These techniques are intended for use in porting C++ code from AccessorC9 to its Cocoa version Accessor. We exploit some characteristics of AccessorC9 in this process.<ul>
			<li>AccessorC9 code is contained in namespace AccessLib, alias <span class='mono'>al</span>. ObjC objects &lt;ClassCP&gt; are used to wrap C++ objects &lt;al::Class&gt;.</li>
			<li>AccessorC9 class al::Host was intended to support polymorphism for executable type and context. al::Host became bottleneck access point to the Application, Window, and SlateManager classes. We now exploit those aspects to provide an access to application-level Objective-C classes from C++ code.</li>
		</ul></li>
	</ul></li>
	<li>As much as possible, we will wrap rather than change existing code until the initial import is complete.</li>
</ul>

<!-- @marker "Porting: Naming Conventions" -->
<h5 id='PortingNamingConventions'>Porting: Naming Conventions</h5><ul>
	<li>Original C++ files for class &lt;Class&gt; are named &lt;Class&gt;_AL.cp/h (or &lt;Class&gt;_C9.cp/h). These are initially imported as is. The implementation file may later be renamed to use extension .mm to enable use of Objective-C code.</li>
	<li>Files for an Objective-C class that wraps the class in files &lt;Class&gt;_AL.cp/h are named &lt;Class&gt;.mm/h. The class itself is temporarily named &lt;Class&gt;CP, since otherwise the compiler could sometimes confuse &lt;Class&gt; with al::&lt;Class&gt;.</li>
	<li>Pure Objective-C classes are in files named &lt;Class&gt;.m/h. Ultimately, pure Objective-C classes will replace all C++ and Objective-C++ classes.</li>
</ul>

<!-- @marker "Deimplement Method" -->
<h4 id='DeimplementMethod'>Deimplement Method</h4><ul>
	<li class='blurb'>use to mark and disable a method that is not yet fully implemented</li>
	<li>add C++ macro _NotYetImplemented_, which always causes an assertion failure, to the beginning of the method</li>
	<li>comment and comment out code as indicated</li>
</ul>

<!-- @marker "Import C++ Class" -->
<h4 id='ImportCppClass'>Import C++ Class</h4><ul>
	<li>copy the existing class files directly into the project's source folder; add new files to project and relevant targets</li>
	<li>make it compile, using these techniques is indicated:<ul>
		<li>make <b>minor</b> editing changes, such as renaming parameters and/or variables named <span class='mono'>id</span></li>
		<li>for code requiring significant change, apply <a href="#DeimplementMethod">Deimplement Method</a></li>
		<li>for missing #included files, either:<ul>
			<li>add the files, or</li>
			<li>comment out the #include; apply <a href="#DeimplementMethod">Deimplement Method</a> as needed</li>
		</ul></li>
	</ul></li>
	<li>compile and test</li>
</ul>

<!-- @marker "Wrap C++ Class with Objective-C" -->
<h4 id='WrapCppClassWithObjC'>Wrap C++ Class with Objective-C</h4><ul>
	<li class='blurb'>based on <a href="http://robnapier.net/blog/wrapping-c-take-2-1-486">Wrapping C++</a></li>	
	<li>create new file &lt;Class&gt;.mm using CPPWrapper template - file also contains starter code for files &lt;Class&gt;.h, &lt;Class&gt;Test.mm/h</li>
	<li>create new empty files &lt;Class&gt;.h, &lt;Class&gt;Test.mm/h; move starter code into the new files</li>
	<li>add new files to project and relevant targets; compile and test</li>
</ul>
	
<p><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></p>
<hr class='footer' />
<p class='footer'>Copyright 2011-12 C &amp; C Software, Inc. All rights reserved.</p>
<p class='footer'>Confidential and Proprietary.</p>
</body>
</html>
